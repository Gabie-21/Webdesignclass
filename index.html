<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USIU Library Study Pod Booking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 8s infinite ease-in-out;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg);
            }

            33% {
                transform: translateY(-30px) rotate(120deg);
            }

            66% {
                transform: translateY(15px) rotate(240deg);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 1s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .glass-panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .panel-title {
            font-size: 1.8rem;
            color: #fff;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title::before {
            content: '';
            width: 4px;
            height: 30px;
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            border-radius: 2px;
        }

        .pod-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .pod-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .pod-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .pod-card:hover::before {
            left: 100%;
        }

        .pod-card:hover {
            transform: scale(1.05);
            border-color: #4CAF50;
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .pod-card.selected {
            border-color: #2196F3;
            background: rgba(33, 150, 243, 0.1);
            transform: scale(1.05);
        }

        .pod-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #333;
        }

        .pod-capacity {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .occupancy-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .occupancy-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            position: relative;
        }

        .input-group label {
            position: absolute;
            top: 12px;
            left: 15px;
            color: #666;
            transition: all 0.3s ease;
            pointer-events: none;
            background: white;
            padding: 0 5px;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group input:not(:placeholder-shown),
        .input-group select:not([value=""]) {
            border-color: #2196F3;
            outline: none;
        }

        .input-group input:focus+label,
        .input-group input:not(:placeholder-shown)+label,
        .input-group select:focus+label,
        .input-group select:not([value=""])+label {
            top: -8px;
            font-size: 12px;
            color: #2196F3;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.4);
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .undo-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }

        .undo-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);
        }

        .undo-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .undo-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .undo-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .history-indicator {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 5px;
            animation: pulse 2s infinite;
        }

        .error-message {
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        .success-message {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
            animation: bounce 0.6s ease-in-out;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.03);
            }
        }

        .bookings-container {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .time-slots-grid {
            display: grid;
            grid-template-columns: auto repeat(12, 1fr);
            gap: 2px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            overflow-x: auto;
        }

        .time-header,
        .pod-label {
            background: #f5f5f5;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            border-radius: 8px;
        }

        .time-slot {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .time-slot.empty {
            background: #e8f5e8;
            border: 2px dashed #c8e6c9;
        }

        .time-slot.occupied {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .time-slot.full {
            background: linear-gradient(45deg, #ff6b6b, #f44336);
            color: white;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
        }

        .time-slot:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .slot-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .time-slot:hover .slot-tooltip {
            opacity: 1;
        }

        .insights-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .insight-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .insight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.3);
        }

        .insight-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .insight-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="floating-particles" id="particles"></div>

    <div class="container">
        <div class="header">
            <h1>📚 USIU Study Pod Central</h1>
            <p>Interactive booking system for premium study spaces</p>
        </div>

        <div class="dashboard">
            <div class="glass-panel">
                <div class="panel-title">🏠 Available Pods</div>
                <div class="pod-grid" id="podGrid"></div>

                <div class="form-section">
                    <form id="bookingForm">
                        <div class="form-row">
                            <div class="input-group">
                                <input type="time" id="timeInput" step="3600" placeholder=" " required>
                                <label>Select Time</label>
                            </div>
                            <div class="input-group">
                                <input type="text" id="studentsInput" placeholder=" " required>
                                <label>Student IDs (comma-separated)</label>
                            </div>
                        </div>
                        <button type="submit" class="submit-btn">
                            <span id="btnText">🚀 Book Pod</span>
                        </button>
                        <button type="button" id="undoBtn" class="undo-btn" onclick="handleUndo()">
                            ↶ Undo Last (0)
                        </button>
                    </form>

                    <div id="errors" class="error-message"></div>
                    <div id="success" class="success-message"></div>
                </div>
            </div>

            <div class="glass-panel">
                <div class="panel-title">📊 Live Dashboard</div>
                <div class="insights-grid" id="insightsGrid"></div>
            </div>
        </div>

        <div class="glass-panel bookings-container">
            <div class="panel-title">📅 Live Booking Grid</div>
            <div class="time-slots-grid" id="timeGrid"></div>
        </div>

        <div class="insights-panel">
            <div class="panel-title">🎯 Advanced Analytics</div>
            <div id="advancedInsights"></div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        /*
         * Enhanced Interactive Features with Undo Functionality:
         * - Variables & data types: objects for tracking animations, arrays for time slots, stack for undo history
         * - Control structures: complex if/else chains for visual states, switch for animations
         * - Loops: for loops creating particles, rendering grids, calculating fill rates
         * - Functions: modular animation functions, visual feedback handlers, undo operations
         * - Events: hover effects, click animations, real-time updates, undo button handling
         * - DOM manipulation: dynamic particle creation, grid rendering, tooltip generation, undo state updates
         */

        // Enhanced data structures with visual state tracking
        const pods = [
            { id: "POD-A", capacity: 4, color: "#4CAF50" },
            { id: "POD-B", capacity: 4, color: "#2196F3" },
            { id: "POD-C", capacity: 4, color: "#FF9800" },
        ];

        const initialBookings = [
            { podId: "POD-A", time: "09:00", students: ["SIT-001", "SIT-045"] },
            { podId: "POD-B", time: "10:00", students: ["SMC-210"] },
        ];

        const timeSlots = [];
        // Generate time slots from 08:00 to 19:00
        for (var i = 8; i < 20; i++) {
            var timeString = (i < 10 ? '0' : '') + i + ':00';
            timeSlots.push(timeString);
        }

        // Enhanced global variables
        var bookings = [];
        var duplicateAttempts = 0;
        var selectedPod = null;
        var animationQueue = [];

        // Undo functionality - stack to track booking history
        var bookingHistoryStack = [];
        var maxHistorySize = 10; // Limit stack size to prevent memory issues

        // Visual Animation Functions

        function createFloatingParticles() {
            var particlesContainer = document.getElementById('particles');

            for (var i = 0; i < 15; i++) {
                var particle = document.createElement('div');
                particle.className = 'particle';

                var size = Math.random() * 60 + 20;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';

                particlesContainer.appendChild(particle);
            }
        }

        function showNotification(message, type) {
            var notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification show';

            if (type === 'error') {
                notification.style.background = 'linear-gradient(45deg, #ff6b6b, #f44336)';
            } else {
                notification.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
            }

            setTimeout(function () {
                notification.classList.remove('show');
            }, 3000);
        }

        function animateButton(button, loading) {
            var btnText = document.getElementById('btnText');
            if (loading) {
                btnText.innerHTML = '<span class="loading-spinner"></span> Processing...';
                button.style.pointerEvents = 'none';
            } else {
                btnText.innerHTML = '🚀 Book Pod';
                button.style.pointerEvents = 'auto';
            }
        }

        // Enhanced Utility Functions

        function parseStudentIds(inputString) {
            var studentArray = inputString.split(',');
            var cleanedStudents = [];

            for (var i = 0; i < studentArray.length; i++) {
                var student = studentArray[i].trim().toUpperCase();
                if (student !== '') {
                    cleanedStudents.push(student);
                }
            }
            return cleanedStudents;
        }

        function isWithinOperatingHours(timeString) {
            if (!timeString || timeString === '') {
                return false;
            }

            var hour = parseInt(timeString.split(':')[0]);
            return hour >= 8 && hour < 20;
        }

        function findBooking(podId, timeString) {
            // Using === for strict equality to avoid type coercion issues with string comparison
            for (var i = 0; i < bookings.length; i++) {
                if (bookings[i].podId === podId && bookings[i].time === timeString) {
                    return bookings[i];
                }
            }
            return null;
        }

        function hasCrossPodClash(studentId, timeString, excludePodId) {
            for (var i = 0; i < bookings.length; i++) {
                if (bookings[i].time === timeString && bookings[i].podId !== excludePodId) {
                    for (var j = 0; j < bookings[i].students.length; j++) {
                        if (bookings[i].students[j] === studentId) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        function customRound(number, decimals) {
            var multiplier = Math.pow(10, decimals);
            return Math.round(number * multiplier) / multiplier;
        }

        function addToHistory(booking) {
            // Add booking to history stack with deep copy to avoid reference issues
            var bookingCopy = {
                podId: booking.podId,
                time: booking.time,
                students: booking.students.slice(), // Create copy of students array
                timestamp: new Date().toISOString()
            };

            bookingHistoryStack.push(bookingCopy);

            // Limit stack size - remove oldest entries if exceeded
            if (bookingHistoryStack.length > maxHistorySize) {
                bookingHistoryStack.shift(); // Remove first (oldest) item
            }

            updateUndoButtonState();
        }

        function undoLastBooking() {
            if (bookingHistoryStack.length === 0) {
                showNotification('No bookings to undo', 'error');
                return false;
            }

            var lastBooking = bookingHistoryStack.pop();

            // Find and remove the booking from main bookings array
            for (var i = bookings.length - 1; i >= 0; i--) {
                if (bookings[i].podId === lastBooking.podId &&
                    bookings[i].time === lastBooking.time) {

                    // Check if it's an exact match (same students)
                    var studentsMatch = true;
                    if (bookings[i].students.length === lastBooking.students.length) {
                        for (var j = 0; j < lastBooking.students.length; j++) {
                            var studentFound = false;
                            for (var k = 0; k < bookings[i].students.length; k++) {
                                if (bookings[i].students[k] === lastBooking.students[j]) {
                                    studentFound = true;
                                    break;
                                }
                            }
                            if (!studentFound) {
                                studentsMatch = false;
                                break;
                            }
                        }
                    } else {
                        studentsMatch = false;
                    }

                    if (studentsMatch) {
                        bookings.splice(i, 1);
                        updateUndoButtonState();
                        return true;
                    }
                }
            }

            // If booking not found, put it back in history
            bookingHistoryStack.push(lastBooking);
            showNotification('Booking not found for undo', 'error');
            return false;
        }

        function updateUndoButtonState() {
            var undoBtn = document.getElementById('undoBtn');
            if (undoBtn) {
                if (bookingHistoryStack.length > 0) {
                    undoBtn.disabled = false;
                    undoBtn.style.opacity = '1';
                    undoBtn.style.cursor = 'pointer';
                    undoBtn.innerHTML = `↶ Undo Last (${bookingHistoryStack.length})`;
                } else {
                    undoBtn.disabled = true;
                    undoBtn.style.opacity = '0.5';
                    undoBtn.style.cursor = 'not-allowed';
                    undoBtn.innerHTML = '↶ Undo Last (0)';
                }
            }
        }

        function validateBooking(podId, timeString, studentIds) {
            if (!isWithinOperatingHours(timeString)) {
                return "Time must be between 08:00 and 19:00";
            }

            if (studentIds.length === 0) {
                return "Please enter at least one student ID";
            }

            var existingBooking = findBooking(podId, timeString);
            var totalStudents = studentIds.length;
            if (existingBooking) {
                totalStudents += existingBooking.students.length;
            }

            if (totalStudents > 4) {
                return "Pod capacity exceeded (maximum 4 students per slot)";
            }

            if (existingBooking) {
                for (var i = 0; i < studentIds.length; i++) {
                    for (var j = 0; j < existingBooking.students.length; j++) {
                        if (studentIds[i] === existingBooking.students[j]) {
                            duplicateAttempts++;
                            return "Student " + studentIds[i] + " is already booked in this pod at this time";
                        }
                    }
                }
            }

            for (var i = 0; i < studentIds.length; i++) {
                if (hasCrossPodClash(studentIds[i], timeString, podId)) {
                    duplicateAttempts++;
                    return "Student " + studentIds[i] + " is already booked in another pod at this time";
                }
            }

            return null;
        }

        // Enhanced Rendering Functions

        function renderPodGrid() {
            var podGrid = document.getElementById('podGrid');
            podGrid.innerHTML = '';

            for (var i = 0; i < pods.length; i++) {
                var podCard = document.createElement('div');
                podCard.className = 'pod-card';
                podCard.setAttribute('data-pod-id', pods[i].id);

                // Calculate current occupancy
                var currentBookings = 0;
                var totalSlots = 0;

                for (var j = 0; j < bookings.length; j++) {
                    if (bookings[j].podId === pods[i].id) {
                        currentBookings += bookings[j].students.length;
                        totalSlots++;
                    }
                }

                var occupancyRate = totalSlots > 0 ? (currentBookings / (totalSlots * 4)) * 100 : 0;

                podCard.innerHTML = `
                    <div class="pod-name">${pods[i].id}</div>
                    <div class="pod-capacity">Capacity: ${pods[i].capacity}</div>
                    <div class="occupancy-bar">
                        <div class="occupancy-fill" style="width: ${occupancyRate}%"></div>
                    </div>
                    <div style="font-size: 0.8rem; color: #666;">${customRound(occupancyRate, 1)}% filled</div>
                `;

                podCard.addEventListener('click', function () {
                    selectPod(this.getAttribute('data-pod-id'));
                });

                podGrid.appendChild(podCard);
            }
        }

        function selectPod(podId) {
            selectedPod = podId;

            // Update visual selection
            var podCards = document.querySelectorAll('.pod-card');
            for (var i = 0; i < podCards.length; i++) {
                podCards[i].classList.remove('selected');
            }

            var selectedCard = document.querySelector(`[data-pod-id="${podId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }

            renderTimeGrid();
        }

        function renderTimeGrid() {
            var timeGrid = document.getElementById('timeGrid');
            timeGrid.innerHTML = '';

            // Header row
            var emptyCell = document.createElement('div');
            emptyCell.className = 'time-header';
            emptyCell.textContent = 'Pod \\ Time';
            timeGrid.appendChild(emptyCell);

            for (var i = 0; i < timeSlots.length; i++) {
                var timeHeader = document.createElement('div');
                timeHeader.className = 'time-header';
                timeHeader.textContent = timeSlots[i];
                timeGrid.appendChild(timeHeader);
            }

            // Pod rows
            for (var i = 0; i < pods.length; i++) {
                var podLabel = document.createElement('div');
                podLabel.className = 'pod-label';
                podLabel.textContent = pods[i].id;
                timeGrid.appendChild(podLabel);

                for (var j = 0; j < timeSlots.length; j++) {
                    var slot = document.createElement('div');
                    slot.className = 'time-slot';

                    var booking = findBooking(pods[i].id, timeSlots[j]);
                    var studentCount = booking ? booking.students.length : 0;

                    if (studentCount === 0) {
                        slot.classList.add('empty');
                        slot.textContent = '0/4';
                    } else if (studentCount === 4) {
                        slot.classList.add('full');
                        slot.textContent = '4/4';
                    } else {
                        slot.classList.add('occupied');
                        slot.textContent = studentCount + '/4';
                    }

                    // Add tooltip
                    var tooltip = document.createElement('div');
                    tooltip.className = 'slot-tooltip';
                    if (booking) {
                        tooltip.textContent = booking.students.join(', ');
                    } else {
                        tooltip.textContent = 'Available';
                    }
                    slot.appendChild(tooltip);

                    // Add click functionality
                    slot.setAttribute('data-pod-id', pods[i].id);
                    slot.setAttribute('data-time', timeSlots[j]);
                    slot.addEventListener('click', function () {
                        selectPod(this.getAttribute('data-pod-id'));
                        document.getElementById('timeInput').value = this.getAttribute('data-time');
                    });

                    timeGrid.appendChild(slot);
                }
            }
        }

        function renderInsights() {
            var insightsGrid = document.getElementById('insightsGrid');
            insightsGrid.innerHTML = '';

            // Total bookings
            var totalBookings = bookings.length;
            var bookingsCard = createInsightCard(totalBookings.toString(), 'Total Bookings', 'pulse');
            insightsGrid.appendChild(bookingsCard);

            // Total unique students
            var uniqueStudents = [];
            for (var i = 0; i < bookings.length; i++) {
                for (var j = 0; j < bookings[i].students.length; j++) {
                    var student = bookings[i].students[j];
                    var isUnique = true;
                    for (var k = 0; k < uniqueStudents.length; k++) {
                        if (uniqueStudents[k] === student) {
                            isUnique = false;
                            break;
                        }
                    }
                    if (isUnique) {
                        uniqueStudents.push(student);
                    }
                }
            }

            var studentsCard = createInsightCard(uniqueStudents.length.toString(), 'Unique Students');
            insightsGrid.appendChild(studentsCard);

            // Busiest hour
            var hourCounts = {};
            for (var i = 0; i < bookings.length; i++) {
                var hour = bookings[i].time;
                if (!hourCounts[hour]) {
                    hourCounts[hour] = 0;
                }
                hourCounts[hour] += bookings[i].students.length;
            }

            var busiestHour = '';
            var maxCount = 0;
            for (var hour in hourCounts) {
                if (hourCounts[hour] > maxCount) {
                    maxCount = hourCounts[hour];
                    busiestHour = hour;
                }
            }

            var busiestCard = createInsightCard(busiestHour || 'None', 'Busiest Hour');
            insightsGrid.appendChild(busiestCard);

            // Flagged duplicates
            var duplicatesCard = createInsightCard(duplicateAttempts.toString(), 'Blocked Attempts');
            insightsGrid.appendChild(duplicatesCard);

            renderAdvancedInsights();
        }

        function createInsightCard(value, label, animation) {
            var card = document.createElement('div');
            card.className = 'insight-card';
            if (animation) {
                card.classList.add(animation);
            }

            card.innerHTML = `
                <div class="insight-value">${value}</div>
                <div class="insight-label">${label}</div>
            `;

            return card;
        }

        function renderAdvancedInsights() {
            var advancedInsights = document.getElementById('advancedInsights');
            advancedInsights.innerHTML = '';

            // Fill-rate per pod with visual bars
            for (var i = 0; i < pods.length; i++) {
                var podId = pods[i].id;
                var podBookings = [];
                var uniqueSlots = [];

                for (var j = 0; j < bookings.length; j++) {
                    if (bookings[j].podId === podId) {
                        podBookings.push(bookings[j]);
                        var slotExists = false;
                        for (var k = 0; k < uniqueSlots.length; k++) {
                            if (uniqueSlots[k] === bookings[j].time) {
                                slotExists = true;
                                break;
                            }
                        }
                        if (!slotExists) {
                            uniqueSlots.push(bookings[j].time);
                        }
                    }
                }

                var totalBookedSeats = 0;
                for (var j = 0; j < podBookings.length; j++) {
                    totalBookedSeats += podBookings[j].students.length;
                }

                var totalPossibleSeats = pods[i].capacity * uniqueSlots.length;
                var fillRate = totalPossibleSeats > 0 ? (totalBookedSeats / totalPossibleSeats) * 100 : 0;

                var fillRateDiv = document.createElement('div');
                fillRateDiv.style.cssText = `
                    background: rgba(255,255,255,0.1);
                    padding: 15px;
                    border-radius: 10px;
                    margin: 10px 0;
                    border-left: 4px solid ${pods[i].color};
                `;

                fillRateDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span style="font-weight: bold; color: white;">${podId} Fill Rate</span>
                        <span style="color: ${pods[i].color}; font-weight: bold;">${customRound(fillRate, 1)}%</span>
                    </div>
                    <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                        <div style="width: ${fillRate}%; height: 100%; background: ${pods[i].color}; border-radius: 4px; transition: width 0.5s ease;"></div>
                    </div>
                `;

                advancedInsights.appendChild(fillRateDiv);
            }
        }

        function showError(message) {
            var errorDiv = document.getElementById('errors');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';

            setTimeout(function () {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            var successDiv = document.getElementById('success');
            successDiv.textContent = message;
            successDiv.style.display = 'block';

            setTimeout(function () {
                successDiv.style.display = 'none';
            }, 3000);
        }

        function clearMessages() {
            document.getElementById('errors').style.display = 'none';
            document.getElementById('success').style.display = 'none';
        }

        // Enhanced Event Handlers

        function handleFormSubmit(event) {
            event.preventDefault();

            var submitBtn = event.target.querySelector('button[type="submit"]');
            animateButton(submitBtn, true);

            // Simulate processing delay for better UX
            setTimeout(function () {
                processBooking(submitBtn);
            }, 800);
        }

        function processBooking(submitBtn) {
            var podId = selectedPod;
            var timeString = document.getElementById('timeInput').value;
            var studentsInput = document.getElementById('studentsInput').value;

            if (!podId) {
                showError('Please select a pod first');
                animateButton(submitBtn, false);
                return;
            }

            var studentIds = parseStudentIds(studentsInput);
            var validationError = validateBooking(podId, timeString, studentIds);

            if (validationError) {
                showError(validationError);
                showNotification(validationError, 'error');
                animateButton(submitBtn, false);
                return;
            }

            // Add or update booking
            var existingBooking = findBooking(podId, timeString);
            var newBooking;

            if (existingBooking) {
                // Store the original state before modification for undo
                var originalStudents = existingBooking.students.slice();
                for (var i = 0; i < studentIds.length; i++) {
                    existingBooking.students.push(studentIds[i]);
                }

                // Create booking object for history (only the new students added)
                newBooking = {
                    podId: podId,
                    time: timeString,
                    students: studentIds
                };
            } else {
                newBooking = {
                    podId: podId,
                    time: timeString,
                    students: studentIds
                };
                bookings.push(newBooking);
            }

            // Add to undo history
            addToHistory(newBooking);

            // Success feedback
            clearMessages();
            var successMessage = `✨ Successfully booked ${studentIds.length} student(s) in ${podId} at ${timeString}`;
            showSuccess(successMessage);
            showNotification(successMessage, 'success');

            // Clear form and focus
            document.getElementById('studentsInput').value = '';
            document.getElementById('studentsInput').focus();

            // Animate button back
            animateButton(submitBtn, false);

            // Re-render with animations
            setTimeout(function () {
                renderPodGrid();
                renderTimeGrid();
                renderInsights();
            }, 300);
        }

        function handleUndo() {
            var undoBtn = document.getElementById('undoBtn');

            // Visual feedback
            undoBtn.style.transform = 'scale(0.95)';
            setTimeout(function () {
                undoBtn.style.transform = '';
            }, 150);

            var success = undoLastBooking();

            if (success) {
                showNotification('✨ Last booking undone successfully!', 'success');
                showSuccess('Last booking has been removed');

                // Re-render with animations
                setTimeout(function () {
                    renderPodGrid();
                    renderTimeGrid();
                    renderInsights();
                }, 200);
            }
        }

        function handleSlotClick(event) {
            if (event.target.classList.contains('time-slot')) {
                var podId = event.target.getAttribute('data-pod-id');
                var time = event.target.getAttribute('data-time');

                selectPod(podId);
                document.getElementById('timeInput').value = time;

                // Visual feedback
                event.target.style.transform = 'scale(1.2)';
                setTimeout(function () {
                    event.target.style.transform = '';
                }, 200);

                // Focus on student input for quick entry
                document.getElementById('studentsInput').focus();
            }
        }

        // Initialize Enhanced Application

        function initApp() {
            // Copy initial bookings
            for (var i = 0; i < initialBookings.length; i++) {
                bookings.push(initialBookings[i]);
            }

            // Create visual effects
            createFloatingParticles();

            // Render initial state
            renderPodGrid();
            renderTimeGrid();
            renderInsights();

            // Auto-select first pod
            if (pods.length > 0) {
                selectPod(pods[0].id);
            }

            // Set up event listeners
            document.getElementById('bookingForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('timeGrid').addEventListener('click', handleSlotClick);

            // Initialize undo button state
            updateUndoButtonState();

            // Add hover effects to form inputs
            var inputs = document.querySelectorAll('input, select');
            for (var i = 0; i < inputs.length; i++) {
                inputs[i].addEventListener('focus', function () {
                    this.parentElement.style.transform = 'translateY(-2px)';
                });

                inputs[i].addEventListener('blur', function () {
                    this.parentElement.style.transform = '';
                });
            }

            // Real-time updates every 30 seconds
            setInterval(function () {
                renderInsights();
            }, 30000);

            // Welcome animation
            setTimeout(function () {
                showNotification('🎉 Welcome to USIU Study Pod Central! Select a pod to get started.', 'success');
            }, 1000);
        }

        // Auto-refresh insights for real-time feel
        function startRealTimeUpdates() {
            setInterval(function () {
                // Simulate real-time activity with subtle animations
                var insightCards = document.querySelectorAll('.insight-card');
                for (var i = 0; i < insightCards.length; i++) {
                    if (Math.random() > 0.8) {
                        insightCards[i].style.transform = 'scale(1.05)';
                        setTimeout(function (card) {
                            return function () {
                                card.style.transform = '';
                            };
                        }(insightCards[i]), 200);
                    }
                }
            }, 5000);
        }

        // Start the enhanced application
        document.addEventListener('DOMContentLoaded', function () {
            initApp();
            startRealTimeUpdates();
        });

        // Initialize immediately if DOM is already ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
            startRealTimeUpdates();
        }
    </script>
</body>

</html>